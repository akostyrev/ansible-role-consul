---

- name: Create Consul configuration directory
  file: >
    path={{ consul_config_dir }}
    owner=root
    group=root
    mode=0755
    state=directory
  tags: consul

- name: Create Consul service file
  template: >
    src=consul.initd.conf.j2
    dest=/etc/init.d/{{ consul_service_name }}
    owner=root
    group=root
    mode=0755
  notify: restart consul
  tags:
    - consul
    - consul-template

- name: update sysconfig /etc/sysconfig/{{ consul_service_name }}
  template:
    src: sysconfig.j2
    dest: /etc/sysconfig/{{ consul_service_name }}
    owner: root
    group: root
    mode: '0644'
  tags:
    - consul
    - consul-template

- name: Create Consul configuration file
  template: >
    src=consul.json.j2
    dest={{ consul_config_dir }}/consul.json
    owner=root
    group={{ consul_config_file_group }}
    mode={{ consul_config_file_mode }}
  notify: restart consul
  tags:
    - consul
    - consul-template

- name: Create Consul services configuration file
  template: >
    src=services.json.j2
    dest={{ consul_config_dir }}/services.json
    owner=root
    group=root
    mode=0644
  notify: reload consul
  tags: consul

- name: Create Consul checks configuration file
  template: >
    src=checks.json.j2
    dest={{ consul_config_dir }}/checks.json
    owner=root
    group=root
    mode=0644
  notify: reload consul
  tags: consul

- name: Create Consul watches configuration file
  template: >
    src=watches.json.j2
    dest={{ consul_config_dir }}/watches.json
    owner=root
    group=root
    mode=0644
  notify: reload consul
  tags: consul
